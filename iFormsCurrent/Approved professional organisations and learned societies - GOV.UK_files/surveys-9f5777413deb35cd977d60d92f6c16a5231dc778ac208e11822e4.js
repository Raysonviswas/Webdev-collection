!function(u){"use strict";window.GOVUK=window.GOVUK||{};var e=function(e,r){return"<a "+(r=r?'class="'+r+'"':"")+' href="{{surveyUrl}}" id="take-survey" target="_blank" rel="noopener noreferrer">'+e+"</a>"},r=function(e){return'<section id="user-satisfaction-survey" class="visible" aria-hidden="false">  <div class="survey-wrapper">    <a class="survey-close-button" href="#user-survey-cancel" aria-labelledby="survey-title user-survey-cancel" id="user-survey-cancel" role="button">Close</a>    <h2 class="survey-title" id="survey-title">{{title}}</h2>'+e+"  </div></section>"},n=r("<p>"+e("{{surveyCta}}","survey-primary-link")+' <span class="postscript-cta">{{surveyCtaPostscript}}</span></p>'),i=r('<div id="email-survey-pre">  <a class="survey-primary-link" href="#email-survey-form" id="email-survey-open" rel="noopener noreferrer" role="button" aria-expanded="false">    {{surveyCta}}  </a></div><form id="email-survey-form" action="/contact/govuk/email-survey-signup" method="post" class="js-hidden" aria-hidden="true">  <div class="survey-inner-wrapper">    <div id="survey-form-description" class="survey-form-description">{{surveyFormDescription}}      <br> {{surveyFormCtaPostscript}}    </div>    <label class="survey-form-label" for="survey-email-address">      Email Address    </label>    <input name="email_survey_signup[survey_id]" type="hidden" value="{{surveyId}}">    <input name="email_survey_signup[survey_source]" type="hidden" value="{{surveySource}}">    <input name="email_survey_signup[ga_client_id]" type="hidden" value="{{gaClientId}}">    <input class="survey-form-input" name="email_survey_signup[email_address]" id="survey-email-address" type="text" aria-describedby="survey-form-description">    <button class="survey-form-button" type="submit">{{surveyFormCta}}</button>'+e("{{surveyFormNoEmailInvite}}")+'  </div></form><div id="email-survey-post-success" class="js-hidden" aria-hidden="true" tabindex="-1">  {{surveySuccess}}</div><div id="email-survey-post-failure" class="js-hidden" aria-hidden="true" tabindex="-1">  {{surveyFailure}}</div>'),t=2,a="(max-width: 800px)",c={defaultSurvey:{url:"https://www.smartsurvey.co.uk/s/gov_uk?c={{currentPath}}",identifier:"user_satisfaction_survey",frequency:6,surveyType:"email"},smallSurveys:[{identifier:"home_office_research_survey_1",surveyType:"url",frequency:5,startTime:new Date("May 01, 2018").getTime(),endTime:new Date("November 01, 2018").getTime(),url:"https://www.homeofficesurveys.homeoffice.gov.uk/s/MLSJL/",templateArgs:{title:"Help improve GOV.UK",surveyCta:"Answer some questions about yourself to join the research community",surveyCtaPostscript:"This link opens in a new tab"},activeWhen:{path:["^/guidance/status-of-eu-nationals-in-the-uk-what-you-need-to-know$","^/government/news/blue-uk-passport-to-return-after-eu-exit$","^/government/publications/eu-citizens-arriving-in-the-uk-during-the-implementation-period/eu-citizens-arriving-in-the-uk-during-the-implementation-period$","^/government/organisations/home-office/about/complaints-procedure$","^/emergency-travel-document/how-to-apply$"]},allowedOnMobile:!0},{identifier:"home_office_research_survey_2",surveyType:"url",frequency:5,startTime:new Date("May 01, 2018").getTime(),endTime:new Date("November 01, 2018").getTime(),url:"https://www.homeofficesurveys.homeoffice.gov.uk/s/WGPEU/",templateArgs:{title:"Help improve GOV.UK",surveyCta:"Answer some questions about yourself to join the research community",surveyCtaPostscript:"This link opens in a new tab"},activeWhen:{path:["^/emergency-travel-document/how-to-apply$","^/government/collections/uk-leaving-the-eu-what-you-need-to-know$","^/guidance/dbs-check-requests-guidance-for-employers$","^/government/case-studies/example-case-studies-eu-citizens-rights-in-the-uk$"]},allowedOnMobile:!0},{identifier:"home_office_research_survey_3",surveyType:"url",frequency:5,startTime:new Date("May 01, 2018").getTime(),endTime:new Date("November 01, 2018").getTime(),url:"https://www.homeofficesurveys.homeoffice.gov.uk/s/B4F8A/",templateArgs:{title:"Help improve GOV.UK",surveyCta:"Answer some questions about yourself to join the research community",surveyCtaPostscript:"This link opens in a new tab"},activeWhen:{path:["^/choose-uk-visit-short-stay-visa$"]},allowedOnMobile:!0},{identifier:"EU Exit",surveyType:"url",frequency:6,startTime:new Date("September 5, 2018").getTime(),endTime:new Date("September 18, 2018").getTime(),url:["https://gdsuserresearch.optimalworkshop.com/treejack/u7dz8d83?c={{currentPath}}","https://gdsuserresearch.optimalworkshop.com/treejack/u7dz8d83-0?c={{currentPath}}","https://gdsuserresearch.optimalworkshop.com/treejack/u7dz8d83-0-0?c={{currentPath}}","https://gdsuserresearch.optimalworkshop.com/treejack/u7dz8d83-0-0-0?c={{currentPath}}"],templateArgs:{title:"Help us make things easier to find on GOV.UK",surveyCta:"Answer 2 quick questions",surveyCtaPostscript:"This activity will open in a separate window"},allowedOnMobile:!0}],init:function(){if(c.canShowAnySurvey()){var e=c.getActiveSurvey(c.defaultSurvey,c.smallSurveys);e!==undefined&&c.displaySurvey(e)}},canShowAnySurvey:function(){return!c.pathInBlacklist()&&(!c.otherNotificationVisible()&&(!c.userCompletedTransaction()&&!(u("#user-satisfaction-survey-container").length<=0)))},processTemplate:function(e,t){return u.each(e,function(e,r){t=t.replace(new RegExp("{{"+e+"}}","g"),r)}),t},getUrlSurveyTemplate:function(){return{render:function(e){var r={title:"Tell us what you think of GOV.UK",surveyCta:"Take the 3 minute survey",surveyCtaPostscript:"This will open a short survey on another website",surveyUrl:c.addParamsToURL(c.getSurveyUrl(e))},t=u.extend(r,e.templateArgs);return c.processTemplate(t,n)}}},getEmailSurveyTemplate:function(){return{render:function(e){var r={title:"Tell us what you think of GOV.UK",surveyCta:"Take a short survey to give us your feedback",surveyFormDescription:"We\u2019ll send you a link to a feedback form. It only takes 2 minutes to fill in.",surveyFormCta:"Send me the survey",surveyFormCtaPostscript:"Don\u2019t worry: we won\u2019t send you spam or share your email address with anyone.",surveyFormNoEmailInvite:"Don\u2019t have an email address?",surveySuccess:"Thanks, we\u2019ve sent you an email with a link to the survey.",surveyFailure:"Sorry, we\u2019re unable to send you an email right now. Please try again later.",surveyId:e.identifier,surveySource:c.currentPath(),surveyUrl:c.addParamsToURL(c.getSurveyUrl(e)),gaClientId:GOVUK.analytics.gaClientId},t=u.extend(r,e.templateArgs);return c.processTemplate(t,i)}}},getActiveSurveys:function(e){return u.grep(e,function(e){if(c.currentTime()>=e.startTime&&c.currentTime()<=e.endTime)return c.activeWhen(e)})},getDisplayableSurveys:function(e){return u.grep(e,function(e){return c.isSurveyToBeDisplayed(e)})},getActiveSurvey:function(e,r){var t=c.getActiveSurveys(r),n=[e].concat(t),i=c.getDisplayableSurveys(n);return i.length<2?i[0]:i[Math.floor(Math.random()*i.length)]},displaySurvey:function(e){var r=u("#user-satisfaction-survey-container");if("email"===e.surveyType)c.displayEmailSurvey(e,r);else{if("url"!==e.surveyType&&e.surveyType!==undefined)return;c.displayURLSurvey(e,r)}c.incrementSurveySeenCounter(e),c.trackEvent(e.identifier,"banner_shown","Banner has been shown")},displayURLSurvey:function(e,r){var t=c.getUrlSurveyTemplate();r.append(t.render(e)),c.setURLSurveyEventHandlers(e)},displayEmailSurvey:function(e,r){var t=c.getEmailSurveyTemplate();r.append(t.render(e)),c.setEmailSurveyEventHandlers(e)},addParamsToURL:function(e){var r=e.replace(/\{\{currentPath\}\}/g,c.currentPath());return-1!==e.indexOf("?c=")?r+"&gcl="+GOVUK.analytics.gaClientId:r+"?gcl="+GOVUK.analytics.gaClientId},setEmailSurveyEventHandlers:function(i){var e=u("#email-survey-open"),r=u("#user-survey-cancel"),t=u("#email-survey-pre"),a=u("#email-survey-form"),s=u("#email-survey-post-success"),o=u("#email-survey-post-failure"),n=u("#survey-email-address");u("#take-survey").click(function(){c.setSurveyTakenCookie(i),c.hideSurvey(i),c.trackEvent(i.identifier,"no_email_link","User taken survey via no email link")}),e.click(function(e){return i.surveyExpanded=!0,c.trackEvent(i.identifier,"email_survey_open","Email survey opened"),t.addClass("js-hidden").attr("aria-hidden","true"),a.removeClass("js-hidden").attr("aria-hidden","false"),n.focus(),e.stopPropagation(),!1}),r.click(function(e){return c.setSurveyTakenCookie(i),c.hideSurvey(i),i.surveyExpanded?c.trackEvent(i.identifier,"email_survey_cancel","Email survey cancelled"):c.trackEvent(i.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),a.submit(function(e){var r=function(){a.addClass("js-hidden").attr("aria-hidden","true"),s.removeClass("js-hidden").attr("aria-hidden","false"),s.focus(),c.setSurveyTakenCookie(i),c.trackEvent(i.identifier,"email_survey_taken","Email survey taken"),c.trackEvent(i.identifier,"banner_taken","User taken survey")},t=function(){a.addClass("js-hidden").attr("aria-hidden","true"),o.removeClass("js-hidden").attr("aria-hidden","false"),o.focus()},n=a.attr("action");return/\.js$/.test(n)||(n+=".js"),u.ajax({type:"POST",url:n,dataType:"json",data:a.serialize(),success:r,error:t,statusCode:{500:t}}),e.stopPropagation(),!1})},setURLSurveyEventHandlers:function(r){var e=u("#user-survey-cancel"),t=u("#take-survey");e.click(function(e){return c.setSurveyTakenCookie(r),c.hideSurvey(r),c.trackEvent(r.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),t.click(function(){c.setSurveyTakenCookie(r),c.hideSurvey(r),c.trackEvent(r.identifier,"banner_taken","User taken survey")})},isSurveyToBeDisplayed:function(e){return!(c.isBeingViewedOnMobile()&&!c.surveyIsAllowedOnMobile(e))&&("true"!==GOVUK.cookie(c.surveyTakenCookieName(e))&&(!c.surveyHasBeenSeenTooManyTimes(e)&&c.randomNumberMatches(e.frequency)))},pathInBlacklist:function(){return new RegExp("^/(?:"+/service-manual/.source+")(?:/|$)").test(c.currentPath())},userCompletedTransaction:function(){function e(e,r){return-1<e.indexOf(r)}var r=c.currentPath();if(e(r,"/done")||e(r,"/transaction-finished")||e(r,"/driving-transaction-finished"))return!0},trackEvent:function(e,r,t){window.GOVUK.analytics.trackEvent(e,r,{label:t,value:1,nonInteraction:!0})},setSurveyTakenCookie:function(e){window.GOVUK.cookie(c.surveyTakenCookieName(e),!0,{days:90})},incrementSurveySeenCounter:function(e){var r=c.surveySeenCookieName(e),t=c.surveySeenCount(e)+1,n=c.seenTooManyTimesCooloff(e);n?window.GOVUK.cookie(r,t,{days:n}):window.GOVUK.cookie(r,t)},seenTooManyTimesCooloff:function(e){return e.seenTooManyTimesCooloff?o(e.seenTooManyTimesCooloff,undefined,1):undefined},hideSurvey:function(){u("#user-satisfaction-survey").removeClass("visible").attr("aria-hidden","true")},randomNumberMatches:function(e){return 0===Math.floor(Math.random()*e)},getSurveyUrl:function(e){return e.url instanceof Array?e.url[Math.floor(Math.random()*e.url.length)]:e.url},otherNotificationVisible:function(){return 0<u([".govuk-emergency-banner:visible","#global-cookie-message:visible","#global-browser-prompt:visible","#taxonomy-survey:visible"].join(", ")).length},surveyHasBeenSeenTooManyTimes:function(e){return c.surveySeenCount(e)>=c.surveySeenTooManyTimesLimit(e)},surveySeenTooManyTimesLimit:function(e){var r=e.seenTooManyTimesLimit;return"unlimited"===String(r).toLowerCase()?Infinity:o(r,t,1)},surveySeenCount:function(e){return o(GOVUK.cookie(c.surveySeenCookieName(e)),0,0)},surveyTakenCookieName:function(e){return s("taken_"+e.identifier)},surveySeenCookieName:function(e){return s("survey_seen_"+e.identifier)},isBeingViewedOnMobile:function(){return window.matchMedia(a).matches},surveyIsAllowedOnMobile:function(e){return e.hasOwnProperty("allowedOnMobile")&&!0===e.allowedOnMobile},pathMatch:function(e){return e!==undefined&&new RegExp(u.map(u.makeArray(e),function(e){return/[\^\$]/.test(e)?"(?:"+e+")":"(?:/"+e+"(?:/|$))"}).join("|")).test(c.currentPath())},breadcrumbMatch:function(e){return e!==undefined&&new RegExp(u.makeArray(e).join("|"),"i").test(c.currentBreadcrumb())},sectionMatch:function(e){if(e===undefined)return!1;var r=new RegExp(u.makeArray(e).join("|"),"i");return r.test(c.currentSection())||r.test(c.currentThemes())},organisationMatch:function(e){return e!==undefined&&new RegExp(u.makeArray(e).join("|")).test(c.currentOrganisation())},tlsCookieMatch:function(e){var r=c.currentTlsVersion();return e!==undefined&&""!=r&&r<e[0]},activeWhen:function(e){if(e.hasOwnProperty("activeWhen")){if(e.activeWhen.hasOwnProperty("path")||e.activeWhen.hasOwnProperty("breadcrumb")||e.activeWhen.hasOwnProperty("section")||e.activeWhen.hasOwnProperty("organisation")||e.activeWhen.hasOwnProperty("tlsCookieVersionLimit")){var r=e.activeWhen.matchType||"include",t=c.tlsCookieMatch(e.activeWhen.tlsCookieVersionLimit),n=c.pathMatch(e.activeWhen.path),i=c.breadcrumbMatch(e.activeWhen.breadcrumb),a=c.sectionMatch(e.activeWhen.section),s=c.organisationMatch(e.activeWhen.organisation),o=t||n||i||a||s;return"exclude"!==r?o:!o}return!0}return!0},currentTime:function(){return(new Date).getTime()},currentPath:function(){return window.location.pathname},currentBreadcrumb:function(){return u(".gem-c-breadcrumbs").text()||""},currentSection:function(){return u('meta[name="govuk:section"]').attr("content")||""},currentThemes:function(){return u('meta[name="govuk:themes"]').attr("content")||""},currentOrganisation:function(){return u('meta[name="govuk:analytics:organisations"]').attr("content")||""},currentTlsVersion:function(){var e=GOVUK.getCookie("TLSversion");return null==e||"unknown"==e?"":parseFloat(e.replace("TLSv",""))||""}},s=function(e){return"govuk_"+e.replace(/(\_\w)/g,function(e){return e.charAt(1).toUpperCase()})},o=function(e,r,t){var n=parseInt(e,10);return isNaN(n)||n<t?r:n};window.GOVUK.userSurveys=c,u(document).ready(function(){GOVUK.userSurveys&&(GOVUK.analytics&&GOVUK.analytics.gaClientId?window.GOVUK.userSurveys.init():u(window).on("gaClientSet",function(){window.GOVUK.userSurveys.init()}))})}(window.jQuery);